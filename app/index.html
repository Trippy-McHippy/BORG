<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>BORG Inbox — Build 0006</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body data-bubble-style="classic">
<div id="topBar">
    <div id="topBarLeft">
      <button class="iconBtn info" id="btnMemory" title="Memory card (save slots)">
        <svg viewBox="0 0 24 24"><path d="M7 6h10a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Zm2 2v10h6V8H9Z"></path></svg>
      </button>
      <button class="iconBtn success" id="btnQuickSave" title="Save to current slot (Ctrl+S)">
        <svg viewBox="0 0 24 24"><path d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7l-4-4Zm-5 18a3 3 0 1 1 0-6 3 3 0 0 1 0 6ZM6 4h10v4H6V4Z"></path></svg>
      </button>
      <button class="iconBtn warn" id="btnUndo" title="Undo (Ctrl+Z) — last 5 steps">
        <svg viewBox="0 0 24 24"><path d="M12 5a7 7 0 0 1 7 7h-2a5 5 0 0 0-5-5H7.83l2.59 2.59L9 11 4 6l5-5 1.41 1.41L7.83 5H12Zm-7 7h2a5 5 0 0 0 5 5h4.17l-2.59-2.59L15 13l5 5-5 5-1.41-1.41L16.17 19H12a7 7 0 0 1-7-7Z"></path></svg>
      </button>
      <div style="width:1px;height:24px;background:rgba(15,23,42,0.18);margin:0 4px;"></div>
      <button class="iconBtn tool" id="btnTool" title="Toggle tool: Move ↔ Lasso (Space: pan when Lasso)">
        <svg viewBox="0 0 24 24"><path d="M3 3h4v2H5v2H3V3Zm14 0h4v4h-2V5h-2V3ZM3 17h2v2h2v2H3v-4Zm16 0h2v4h-4v-2h2v-2ZM12 7c3 0 5 2 5 5s-2 5-5 5-5-2-5-5 2-5 5-5Z"></path></svg>
      </button>
      <button class="iconBtn warn" id="btnCenter" title="Centre / fit bubbles">
        <svg viewBox="0 0 24 24"><path d="M11 2h2v3a7 7 0 0 1 6 6h3v2h-3a7 7 0 0 1-6 6v3h-2v-3a7 7 0 0 1-6-6H2v-2h3a7 7 0 0 1 6-6V2Zm1 5a5 5 0 1 0 0 10 5 5 0 0 0 0-10Z"></path></svg>
      </button>
      <button class="iconBtn warn" id="btnClear" title="Clear all bubbles (working state)">
        <svg viewBox="0 0 24 24"><path d="M9 3h6l1 2h5v2H3V5h5l1-2Zm1 7h2v8h-2v-8Zm4 0h2v8h-2v-8ZM7 10h2v8H7v-8Z"></path></svg>
      </button>
    </div>

    <div id="topMeta">
      <span id="appTitle">BORG Inbox</span>
      <span>Build <code id="buildCode">0005</code></span>
      <span>Slot <code id="slotCode">01</code></span>
      <span class="badge" id="savedBadge">Saved</span>
      <span class="badge" id="hintBadge">Shift: multi-select · Ctrl: link · DblClick: edit</span>
      <span class="badge" id="toolBadge">Tool: Move</span>
    </div>

    <div id="topBarRight">
      <span class="badge" id="countBadge">0 bubbles</span>
    </div>
  </div>

  <div id="layout">
    <aside id="leftPanel" class="panel">
      <div id="leftScroll">
        <fieldset class="section">
          <legend class="sectionLegend">
            <span class="sectionTitle">Create / Edit Bubble</span>
            <button class="collapseBtn" type="button" data-collapse="form" title="Collapse">▾</button>
          </legend>
          <div class="sectionBody" data-body="form">
            <form id="bubbleForm">
              <input type="hidden" id="eid"/>

              <label class="hdr">Type</label>
              <select id="etype" tabindex="1"></select>

              <label class="hdr">Title</label>
              <input id="etitle" placeholder="Short title" tabindex="2"/>

              <label class="hdr">Details</label>
              <textarea id="edetails" placeholder="Notes, list items, URLs, phone numbers…" tabindex="3"></textarea>
              <div class="hint">Keyboard: <b>Enter</b> saves. In Details: <b>Shift+Enter</b> makes a new line.</div>

              <div class="row2">
                <div>
                  <label class="hdr">Status</label>
                  <select id="estatus" tabindex="4">
                    <option value="inbox">Inbox</option>
                    <option value="active">Active</option>
                    <option value="done">Done</option>
                    <option value="archived">Archived</option>
                  </select>
                </div>
                <div>
                  <label class="hdr">Priority</label>
                  <select id="epriority" tabindex="5">
                    <option value="normal">Normal</option>
                    <option value="priority">Priority</option>
                    <option value="urgent">Urgent</option>
                    <option value="immediate">Immediate</option>
                  </select>
                </div>
              </div>

              <div class="row2">
                <div>
                  <label class="hdr">When (optional)</label>
                  <input id="ewhen" type="datetime-local" tabindex="6"/>
                </div>
                <div>
                  <label class="hdr">Due (optional)</label>
                  <input id="edue" type="date" tabindex="7"/>
                </div>
              </div>

              <div class="row2">
                <div>
                  <label class="hdr">Recurring</label>
                  <select id="erecurFreq" tabindex="8">
                    <option value="none">None</option>
                    <option value="day">Daily</option>
                    <option value="week">Weekly</option>
                    <option value="month">Monthly</option>
                    <option value="year">Yearly</option>
                  </select>
                </div>
                <div>
                  <label class="hdr">Every</label>
                  <input id="erecurInt" type="number" min="1" step="1" value="1" tabindex="9"/>
                </div>
              </div>

              <label class="hdr">Tags (comma-separated)</label>
              <input id="etags" placeholder="home, work, errands" tabindex="10" list="tagSuggestions"/>
              <datalist id="tagSuggestions"></datalist>

              <div class="row2" style="margin-top:10px;">
                <button id="btnSaveBubble" type="submit" tabindex="11">Save (Enter)</button>
                <button class="secondary" id="btnClearForm" type="button" tabindex="12">Clear (Esc)</button>
              </div>
            </form>
          </div>
        </fieldset>

        <fieldset class="section">
          <legend class="sectionLegend">
            <span class="sectionTitle">Options</span>
            <button class="collapseBtn" type="button" data-collapse="options" title="Collapse">▾</button>
          </legend>
          <div class="sectionBody" data-body="options">
            <div class="toggleRow">
              <div class="lbl">Confirm delete</div>
              <input type="checkbox" id="optConfirmDelete" checked/>
            </div>
            <div class="toggleRow">
              <div class="lbl">Show grid</div>
              <input type="checkbox" id="optShowGrid" checked/>
            </div>
            <div class="toggleRow">
              <div class="lbl">Snap to grid</div>
              <input type="checkbox" id="optSnap"/>
            </div>
            <div class="toggleRow">
              <div class="lbl">Recurring “Done” advances date</div>
              <input type="checkbox" id="optRecurAdvance" checked/>
            </div>

            <label class="hdr">Drag tool (default: Move)</label>
            <select id="optTool">
              <option value="move" selected>Move (pan canvas)</option>
              <option value="lasso">Lasso (select)</option>
            </select>
            <div class="hint">Tip: when Tool = Lasso, hold <b>Space</b> to pan.</div>

            <label class="hdr">Snap size</label>
            <select id="optSnapSize">
              <option value="20">20</option>
              <option value="30">30</option>
              <option value="40" selected>40</option>
              <option value="60">60</option>
            </select>

            <label class="hdr">Connector thickness</label>
            <select id="connThick">
              <option value="1">1</option>
              <option value="2" selected>2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="6">6</option>
              <option value="8">8</option>
              <option value="12">12</option>
            </select>

            <div class="row2" style="margin-top:10px;">
              <button class="secondary" id="btnManageTypes" type="button">Manage Types</button>
              <button class="secondary" id="btnManageTags" type="button">Manage Tags</button>
            </div>

            <div class="hint" style="margin-top:10px;">
              • <b>Click canvas</b>: deselect<br/>
              • <b>Shift-click</b>: multi-select<br/>
              • <b>Ctrl/⌘-click bubble</b>: link/unlink to selection<br/>
              • <b>Shift-drag canvas</b>: temporary lasso (Ctrl/⌘+Shift adds)<br/>
              • Drag selected bubble: moves the whole selection<br/>
              • <b>Double-click bubble</b>: inline edit<br/>
              • Bubble corner: resize
            </div>
          </div>
        </fieldset>

        <fieldset class="section">
          <legend class="sectionLegend">
            <span class="sectionTitle">Theme</span>
            <button class="collapseBtn" type="button" data-collapse="theme" title="Collapse">▾</button>
          </legend>
          <div class="sectionBody" data-body="theme">
            <label class="hdr">Canvas colour</label>
            <div class="swatchGrid" id="canvasSwatches"></div>

            <label class="hdr">Default bubble colour</label>
            <div class="swatchGrid" id="bubbleSwatches"></div>

            <div class="row2">
              <div>
                <label class="hdr">Accent</label>
                <input id="accent1" type="color" style="height:36px;" value="#2563eb"/>
              </div>
              <div>
                <label class="hdr">Accent 2</label>
                <input id="accent2" type="color" style="height:36px;" value="#7c3aed"/>
              </div>
            </div>

            <label class="hdr">Bubble style</label>
            <select id="bubbleStyle">
              <option value="classic">Classic</option>
              <option value="soft">Soft</option>
              <option value="glass">Glass</option>
              <option value="outline">Outline</option>
            </select>

            <div class="hint">Theme auto-adjusts text/readability based on the canvas colour.</div>
          </div>
        </fieldset>
      </div>
    </aside>

    <main id="center" class="panel">
      <div id="workspaceWrap">
        <div id="workspaceTop">
          <div class="mini">
            <span class="badge" id="panZoomBadge">100% · x0 y0</span>
            <span class="badge" id="selectionBadge">0 selected</span>
          </div>
          <div class="mini">
            <span class="badge" id="connBadge">0 links</span>
            <span class="badge" id="clockBadge">—</span>
          </div>
        </div>
        <div id="workspace-container">
          <div id="lasso"></div>
          <div id="canvasInner">
            <div id="grid"></div>
            <svg id="connectors" viewBox="0 0 8000 8000" preserveAspectRatio="none"></svg>
            <div id="bubbles"></div>
          </div>
        </div>
      </div>
    </main>

    <aside id="rightPanel" class="panel">
      <div id="rightTopBar">
        <div class="row2" style="gap:8px;">
          <div style="flex: 1 1 240px;">
            <input id="searchBox" placeholder="Search…"/>
          </div>
          <div style="flex: 1 1 120px; min-width:120px;">
            <select id="viewMode">
              <option value="flat" selected>Flat list</option>
              <option value="byStatus">Group: Status</option>
              <option value="byType">Group: Type</option>
              <option value="byDue">Group: Due / When</option>
              <option value="byTag">Group: Tags</option>
            </select>
          </div>
        </div>
        <div class="row2" style="gap:8px;">
          <div style="flex:1 1 160px;">
            <select id="filterType"></select>
          </div>
          <div style="flex:1 1 170px;">
            <select id="sortBy">
              <option value="updated_desc">Updated (new)</option>
              <option value="created_desc">Created (new)</option>
              <option value="when_asc">When (soon)</option>
              <option value="due_asc">Due (soon)</option>
              <option value="title_asc">Title (A→Z)</option>
            </select>
          </div>
        </div>
      </div>
      <div id="recordList">
        <div class="sectionHeader">
          <span style="flex:1;">Overview</span>
          <span class="badge" id="overviewBadge">—</span>
        </div>
        <div class="scroller" id="listScroller"></div>
      </div>
    </aside>
  </div>

  <!-- Memory card -->
  <dialog id="memoryDlg">
    <div class="dlgHd">
      <h3>Memory card — Save slots</h3>
      <button class="secondary" id="btnCloseMemory" type="button" style="height:32px; padding:0 10px; border-radius: 12px;">Close</button>
    </div>
    <div class="dlgBd">
      <div class="hint">
        One local JSON store holds <b>Working state</b> + these slots. Slots are snapshots you can name/overwrite/delete.<br/>
        Tip: click a slot name to rename it, then press Enter.
      </div>
      <div style="margin-top: 12px;" class="slotGrid" id="slotGrid"></div>
    </div>
    <div class="dlgFt">
      <button class="secondary" id="btnWipeSlots" type="button">Wipe all slots</button>
    </div>
  </dialog>

  <!-- Type manager -->
  <dialog id="typesDlg">
    <div class="dlgHd">
      <h3>Manage bubble types</h3>
      <button class="secondary" id="btnCloseTypes" type="button" style="height:32px; padding:0 10px; border-radius: 12px;">Close</button>
    </div>
    <div class="dlgBd">
      <div class="hint">Rename types in-place. Deleting a type reassigns its bubbles to “note”.</div>
      <div style="margin-top:12px;" id="typesList"></div>
      <div class="mgrRow" style="margin-top:10px;">
        <input id="newTypeName" placeholder="Add new type (e.g., 'Project')" maxlength="32"/>
        <button id="btnAddType" type="button">Add</button>
      </div>
    </div>
    <div class="dlgFt">
      <button class="secondary" id="btnResetTypes" type="button">Reset to defaults</button>
    </div>
  </dialog>

  <!-- Tag manager -->
  <dialog id="tagsDlg">
    <div class="dlgHd">
      <h3>Manage tags</h3>
      <button class="secondary" id="btnCloseTags" type="button" style="height:32px; padding:0 10px; border-radius: 12px;">Close</button>
    </div>
    <div class="dlgBd">
      <div class="hint">Tags are suggestions + for grouping. Renaming updates bubbles. Deleting removes the tag from all bubbles.</div>
      <div style="margin-top:12px;" id="tagsList"></div>
      <div class="mgrRow" style="margin-top:10px;">
        <input id="newTagName" placeholder="Add new tag (e.g., 'home')" maxlength="24"/>
        <button id="btnAddTag" type="button">Add</button>
      </div>
    </div>
    <div class="dlgFt">
      <button class="secondary" id="btnHarvestTags" type="button">Harvest tags from bubbles</button>
    </div>
  </dialog>

  <!-- Error popup -->
  <dialog id="errorDlg">
    <div class="dlgHd">
      <h3>Runtime error</h3>
      <button class="secondary" id="btnCloseError" type="button" style="height:32px; padding:0 10px; border-radius: 12px;">Close</button>
    </div>
    <div class="dlgBd">
      <div class="hint">Copy this and paste it to me. It includes build + slot + stack trace.</div>
      <div style="margin-top:10px;">
        <pre class="mono" id="errorPre">—</pre>
      </div>
    </div>
    <div class="dlgFt">
      <button id="btnCopyError" type="button">Copy to clipboard</button>
    </div>
  </dialog>

  <script type="module" src="./src/main.js"></script>
</body>
</html>
